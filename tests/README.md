# å‰ç«¯ E2E æ¸¬è©¦

æœ¬ç›®éŒ„åŒ…å«ä½¿ç”¨ [Playwright](https://playwright.dev/) æ’°å¯«çš„å‰ç«¯ç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰æ¸¬è©¦ã€‚

## ğŸ“ ç›®éŒ„çµæ§‹

```
tests/
â”œâ”€â”€ README.md              # æœ¬èªªæ˜æ–‡ä»¶
â”œâ”€â”€ helpers/               # æ¸¬è©¦è¼”åŠ©å·¥å…·
â”‚   â””â”€â”€ auth.ts           # ç™»å…¥/ç™»å‡ºè¼”åŠ©å‡½æ•¸
â””â”€â”€ crm/                   # CRM æ¨¡çµ„æ¸¬è©¦
    â”œâ”€â”€ login.spec.ts     # ç™»å…¥åŠŸèƒ½æ¸¬è©¦
    â”œâ”€â”€ customers.spec.ts # å®¢æˆ¶ç®¡ç†æ¸¬è©¦
    â”œâ”€â”€ contacts.spec.ts  # è¯çµ¡äººç®¡ç†æ¸¬è©¦
    â”œâ”€â”€ quotes.spec.ts    # å ±åƒ¹å–®ç®¡ç†æ¸¬è©¦
    â”œâ”€â”€ orders.spec.ts    # è¨‚è²¨å–®ç®¡ç†æ¸¬è©¦
    â””â”€â”€ navigation.spec.ts # å°èˆªèˆ‡ç«¯åˆ°ç«¯æµç¨‹æ¸¬è©¦
```

## ğŸ”§ ç’°å¢ƒè¨­å®š

### å‰ç½®éœ€æ±‚

- Node.js >= 18
- å·²å®‰è£å°ˆæ¡ˆä¾è³´ (`npm install`)
- Playwright ç€è¦½å™¨å·²å®‰è£

### å®‰è£ Playwright ç€è¦½å™¨

```bash
npx playwright install
```

### ç’°å¢ƒé…ç½®

æ¸¬è©¦é è¨­é€£æ¥åˆ° `http://localhost:3001`ï¼ˆå‰ç«¯é–‹ç™¼ä¼ºæœå™¨ï¼‰ã€‚

å¦‚éœ€ä¿®æ”¹ï¼Œè«‹ç·¨è¼¯ `playwright.config.ts` ä¸­çš„ `baseURL` è¨­å®šã€‚

## ğŸš€ åŸ·è¡Œæ¸¬è©¦

### å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼

åŸ·è¡Œæ¸¬è©¦å‰ï¼Œè«‹ç¢ºä¿å‰å¾Œç«¯æœå‹™æ­£åœ¨é‹è¡Œï¼š

```bash
# åŒæ™‚å•Ÿå‹•å‰å¾Œç«¯
npm run dev:full

# æˆ–åˆ†åˆ¥å•Ÿå‹•
npm run start:dev      # å¾Œç«¯
npm run frontend:dev   # å‰ç«¯
```

### åŸ·è¡Œæ¸¬è©¦å‘½ä»¤

```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
npx playwright test

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦æª”æ¡ˆ
npx playwright test tests/crm/login.spec.ts

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦ç›®éŒ„
npx playwright test tests/crm/

# ä»¥ UI æ¨¡å¼åŸ·è¡Œï¼ˆå¯è¦–åŒ–ä»‹é¢ï¼‰
npx playwright test --ui

# ä»¥ headed æ¨¡å¼åŸ·è¡Œï¼ˆé¡¯ç¤ºç€è¦½å™¨ï¼‰
npx playwright test --headed

# åªåŸ·è¡Œç‰¹å®šç€è¦½å™¨
npx playwright test --project=chromium
npx playwright test --project=firefox
npx playwright test --project=webkit

# åŸ·è¡Œä¸¦ç”¢ç”Ÿå ±å‘Š
npx playwright test --reporter=html

# æŸ¥çœ‹æ¸¬è©¦å ±å‘Š
npx playwright show-report
```

### åµéŒ¯æ¸¬è©¦

```bash
# ä»¥åµéŒ¯æ¨¡å¼åŸ·è¡Œ
npx playwright test --debug

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦ä¸¦åµéŒ¯
npx playwright test tests/crm/login.spec.ts --debug

# ç”¢ç”Ÿè¿½è¹¤æª”æ¡ˆ
npx playwright test --trace on
```

## ğŸ“‹ æ¸¬è©¦æ¶µè“‹ç¯„åœ

### ç™»å…¥åŠŸèƒ½ (`login.spec.ts`)

| æ¸¬è©¦é …ç›® | èªªæ˜ |
|---------|------|
| é é¢é¡¯ç¤º | é©—è­‰ç™»å…¥é é¢æ­£ç¢ºé¡¯ç¤º |
| è¡¨å–®é©—è­‰ | å¿…å¡«æ¬„ä½ã€æŒ‰éˆ•ç‹€æ…‹æª¢æŸ¥ |
| æˆåŠŸç™»å…¥ | ä½¿ç”¨æ­£ç¢ºå¸³è™Ÿå¯†ç¢¼ç™»å…¥ |
| ç™»å…¥å¤±æ•— | éŒ¯èª¤å¸³è™Ÿå¯†ç¢¼è™•ç† |
| é‡å°å‘ | å·²ç™»å…¥/æœªç™»å…¥ç‹€æ…‹çš„é é¢é‡å°å‘ |
| éµç›¤æ“ä½œ | Enter éµæäº¤è¡¨å–® |

### å®¢æˆ¶ç®¡ç† (`customers.spec.ts`)

| æ¸¬è©¦é …ç›® | èªªæ˜ |
|---------|------|
| é é¢å…ƒç´  | æ¨™é¡Œã€æŒ‰éˆ•ã€æœå°‹æ¬„ä½é¡¯ç¤º |
| æ–°å¢å®¢æˆ¶ | Modal é–‹å•Ÿã€è¡¨å–®æ¬„ä½ã€é©—è­‰ |
| æœå°‹åŠŸèƒ½ | é—œéµå­—æœå°‹å®¢æˆ¶ |
| æŸ¥çœ‹è©³æƒ… | é»æ“Šå®¢æˆ¶ ID æŸ¥çœ‹è©³æƒ… |
| ç·¨è¼¯å®¢æˆ¶ | ç·¨è¼¯ Modal åŠŸèƒ½ |
| è¯çµ¡äººå°èˆª | å°èˆªåˆ°å®¢æˆ¶è¯çµ¡äººé é¢ |
| åˆ†é åŠŸèƒ½ | åˆ†é å…ƒä»¶æ“ä½œ |

### è¯çµ¡äººç®¡ç† (`contacts.spec.ts`)

| æ¸¬è©¦é …ç›® | èªªæ˜ |
|---------|------|
| é é¢é¡¯ç¤º | è¯çµ¡äººåˆ—è¡¨æ­£ç¢ºé¡¯ç¤º |
| æœå°‹åŠŸèƒ½ | æœå°‹è¯çµ¡äºº |
| å®¢æˆ¶è¯çµ¡äºº | ç‰¹å®šå®¢æˆ¶çš„è¯çµ¡äººé é¢ |

### å ±åƒ¹å–®ç®¡ç† (`quotes.spec.ts`)

| æ¸¬è©¦é …ç›® | èªªæ˜ |
|---------|------|
| é é¢å…ƒç´  | æ¨™é¡Œã€æè¿°ã€ç¯©é¸å™¨é¡¯ç¤º |
| ç‹€æ…‹ç¯©é¸ | å¾…ç°½å/å·²ç°½åç¯©é¸ |
| æœå°‹åŠŸèƒ½ | æœå°‹å ±åƒ¹å–® |
| ç·¨è¼¯æ¨¡å¼ | é›™æ“Š/F2 é€²å…¥ç·¨è¼¯ |
| è½‰è¨‚è²¨å–® | å·²ç°½åå ±åƒ¹å–®è½‰æ›åŠŸèƒ½ |
| æŸ¥çœ‹è©³æƒ… | å°èˆªåˆ°å ±åƒ¹å–®è©³æƒ…é  |

### è¨‚è²¨å–®ç®¡ç† (`orders.spec.ts`)

| æ¸¬è©¦é …ç›® | èªªæ˜ |
|---------|------|
| é é¢å…ƒç´  | æ¨™é¡Œã€æè¿°ã€ç¯©é¸å™¨é¡¯ç¤º |
| ç‹€æ…‹ç¯©é¸ | é€²è¡Œä¸­/å·²å®Œæˆç¯©é¸ |
| æœå°‹åŠŸèƒ½ | æœå°‹è¨‚è²¨å–® |
| æ–°å¢åŠŸèƒ½ | æ–°å¢è¡Œé¡¯ç¤ºèˆ‡å¡«å¯« |
| ç·¨è¼¯åŠŸèƒ½ | ç·¨è¼¯æ¨¡å¼èˆ‡å–æ¶ˆ |
| å®Œæˆè¨‚å–® | æ¨™è¨˜è¨‚å–®ç‚ºå·²å®Œæˆ |
| åˆªé™¤åŠŸèƒ½ | åˆªé™¤ç¢ºèªå°è©±æ¡† |
| éµç›¤å¿«æ·éµ | â†‘â†“ ç§»å‹•ã€Enter æŸ¥çœ‹ã€F2 ç·¨è¼¯ã€Delete åˆªé™¤ã€N æ–°å¢ |

### å°èˆªèˆ‡ç«¯åˆ°ç«¯ (`navigation.spec.ts`)

| æ¸¬è©¦é …ç›® | èªªæ˜ |
|---------|------|
| é é¢å°èˆª | CRM å­é é¢ä¹‹é–“å°èˆª |
| ç€è¦½å™¨æ“ä½œ | è¿”å›æŒ‰éˆ•åŠŸèƒ½ |
| ç™»å…¥ç‹€æ…‹ | å°èˆªæ™‚ä¿æŒç™»å…¥ |
| é é¢æ¨™é¡Œ | æ­£ç¢ºé¡¯ç¤ºé é¢æ¨™é¡Œ |
| éŸ¿æ‡‰å¼è¨­è¨ˆ | æ¡Œé¢/å¹³æ¿/æ‰‹æ©Ÿè¦–çª— |
| éŒ¯èª¤è™•ç† | ä¸å­˜åœ¨é é¢ã€ç„¡æ•ˆ ID |
| æ•ˆèƒ½æ¸¬è©¦ | é é¢è¼‰å…¥æ™‚é–“ |

## ğŸ”‘ æ¸¬è©¦å¸³è™Ÿ

æ¸¬è©¦ä½¿ç”¨ä»¥ä¸‹é è¨­å¸³è™Ÿï¼š

```typescript
{
  username: 'admin',
  password: 'a123456'
}
```

å¸³è™Ÿè¨­å®šä½æ–¼ `tests/helpers/auth.ts`ã€‚

## ğŸ“ æ’°å¯«æ–°æ¸¬è©¦

### åŸºæœ¬ç¯„ä¾‹

```typescript
import { test, expect } from '@playwright/test';
import { login, logout } from '../helpers/auth';

test.describe('åŠŸèƒ½åç¨±', () => {
  test.beforeEach(async ({ page }) => {
    await login(page);
    await page.goto('/your-page');
  });

  test.afterEach(async ({ page }) => {
    await logout(page);
  });

  test('æ‡‰è©²é¡¯ç¤ºæŸå€‹å…ƒç´ ', async ({ page }) => {
    await expect(page.getByRole('heading', { name: 'æ¨™é¡Œ' })).toBeVisible();
  });

  test('æ‡‰è©²èƒ½å¤ åŸ·è¡ŒæŸå€‹æ“ä½œ', async ({ page }) => {
    await page.getByRole('button', { name: 'æŒ‰éˆ•' }).click();
    await expect(page).toHaveURL('/expected-url');
  });
});
```

### æœ€ä½³å¯¦è¸

1. **ä½¿ç”¨è¼”åŠ©å‡½æ•¸**ï¼šç™»å…¥/ç™»å‡ºä½¿ç”¨ `helpers/auth.ts` ä¸­çš„å‡½æ•¸
2. **ç­‰å¾…é é¢è¼‰å…¥**ï¼šä½¿ç”¨ `waitForSelector` æˆ– `waitForLoadState`
3. **èªæ„åŒ–é¸æ“‡å™¨**ï¼šå„ªå…ˆä½¿ç”¨ `getByRole`ã€`getByLabel`ã€`getByText`
4. **ç¨ç«‹æ¸¬è©¦**ï¼šæ¯å€‹æ¸¬è©¦æ‡‰è©²ç¨ç«‹åŸ·è¡Œï¼Œä¸ä¾è³´å…¶ä»–æ¸¬è©¦çš„ç‹€æ…‹
5. **æ¸…ç†ç‹€æ…‹**ï¼šåœ¨ `afterEach` ä¸­æ¸…ç†æ¸¬è©¦ç”¢ç”Ÿçš„è³‡æ–™

## ğŸ”§ è¨­å®šæª”èªªæ˜

### playwright.config.ts

```typescript
export default defineConfig({
  testDir: './tests',           // æ¸¬è©¦ç›®éŒ„
  fullyParallel: true,          // å¹³è¡ŒåŸ·è¡Œæ¸¬è©¦
  retries: process.env.CI ? 2 : 0,  // CI ç’°å¢ƒé‡è©¦æ¬¡æ•¸
  use: {
    baseURL: 'http://localhost:3001',  // å‰ç«¯ URL
    trace: 'on-first-retry',           // å¤±æ•—æ™‚ç”¢ç”Ÿè¿½è¹¤
  },
  projects: [
    { name: 'chromium', use: { ...devices['Desktop Chrome'] } },
    { name: 'firefox', use: { ...devices['Desktop Firefox'] } },
    { name: 'webkit', use: { ...devices['Desktop Safari'] } },
  ],
});
```

## ğŸš¨ æ³¨æ„äº‹é …

1. **æ¸¬è©¦è³‡æ–™**ï¼šéƒ¨åˆ†æ¸¬è©¦æœƒå»ºç«‹æ¸¬è©¦è³‡æ–™ï¼Œè«‹ç¢ºä¿æ¸¬è©¦ç’°å¢ƒå¯ä»¥æ¥å—è³‡æ–™è®Šæ›´
2. **å¹³è¡ŒåŸ·è¡Œ**ï¼šæ¸¬è©¦é è¨­å¹³è¡ŒåŸ·è¡Œï¼Œè«‹ç¢ºä¿æ¸¬è©¦ä¹‹é–“ä¸æœƒäº’ç›¸å¹²æ“¾
3. **ç¶²è·¯ä¾è³´**ï¼šæ¸¬è©¦éœ€è¦å¾Œç«¯ API æœå‹™æ­£å¸¸é‹è¡Œ
4. **ç€è¦½å™¨ç‰ˆæœ¬**ï¼šå»ºè­°å®šæœŸæ›´æ–° Playwright ç€è¦½å™¨ (`npx playwright install`)

## ğŸ“š åƒè€ƒè³‡æº

- [Playwright å®˜æ–¹æ–‡æª”](https://playwright.dev/docs/intro)
- [Playwright æ¸¬è©¦ç”Ÿæˆå™¨](https://playwright.dev/docs/codegen)
- [Playwright æœ€ä½³å¯¦è¸](https://playwright.dev/docs/best-practices)
